<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Translator - Convertly</title>
    <meta name="description" content="Upload audio to get a transcription and translation in over 50 languages.">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="bg-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-3" style="top: 80%; right: 10%;"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="logo">
            <a href="../../index.html"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px;">
                <div class="logo-icon"><i class="fas fa-layer-group"></i></div>
                <span>CONVERTLY</span>
            </a>
        </div>
        <div class="nav-links">
            <a href="../../index.html" class="nav-btn">Uploads</a>
            <a href="../../dashboard.html" class="nav-btn active" style="background: rgba(15, 23, 42, 0.05);">AI Tools
                <i class="fas fa-magic"></i></a>
        </div>
    </nav>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Media Tools</h3>
            </div>
            <a href="../../dashboard.html" class="tool-nav-btn"><i class="fas fa-th-large"></i> Dashboard</a>
            <a href="../mp3-extractor/index.html" class="tool-nav-btn"><i class="fas fa-music"></i> MP3 Extractor</a>
            <a href="../youtube-summary/index.html" class="tool-nav-btn"><i class="fab fa-youtube"></i> YouTube
                Summary</a>
            <a href="../audio-translator/index.html" class="tool-nav-btn active"><i class="fas fa-language"></i> Audio
                Translator</a>
            <a href="../image-resizer/index.html" class="tool-nav-btn"><i class="fas fa-crop-alt"></i> Auto Resizer</a>

            <div class="sidebar-header" style="margin-top: 1rem;">
                <h3>Utility Tools</h3>
            </div>
            <a href="../privacy-redactor/index.html" class="tool-nav-btn"><i class="fas fa-user-secret"></i> Privacy
                Redactor</a>
            <a href="../site-cloner/index.html" class="tool-nav-btn"><i class="fas fa-clone"></i> Site Cloner</a>
            <a href="../code-commenter/index.html" class="tool-nav-btn"><i class="fas fa-code"></i> Code Commenter</a>
            <a href="../terminal-helper/index.html" class="tool-nav-btn"><i class="fas fa-terminal"></i> Terminal
                Helper</a>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-content">
            <div class="tool-header">
                <h1>Audio Translator</h1>
                <p>Upload audio to get a transcription and translation.</p>
            </div>

            <div class="active-tool-container">
                <div class="tool-content" style="max-width: 800px; margin: 0 auto;">
                    <!-- Upload Area -->
                    <div class="upload-area" id="audio-drop-zone"
                        style="border: 2px dashed var(--border); padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 2rem; transition: all 0.3s ease;">
                        <i class="fas fa-music"
                            style="font-size: 3rem; color: var(--text-gray); margin-bottom: 1rem;"></i>
                        <h3 style="margin-bottom: 0.5rem;">Drag & Drop Audio</h3>
                        <p style="color: var(--text-gray); margin-bottom: 1rem;">or click to browse (MP3, WAV)</p>
                        <input type="file" id="audio-upload" accept="audio/*" style="display: none;">
                        <button class="secondary-btn" onclick="document.getElementById('audio-upload').click()">Browse
                            Files</button>
                    </div>

                    <!-- Target Language Selection -->
                    <div style="margin-bottom: 1.5rem; text-align: center;">
                        <label style="margin-right: 1rem; color: var(--text-gray);">Target Language:</label>
                        <select id="target-lang"
                            style="padding: 0.5rem; border-radius: 0.5rem; background: var(--glass-bg); color: var(--text); border: 1px solid var(--border);">
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="zh-CN">Chinese (Simplified)</option>
                            <option value="ja">Japanese</option>
                            <option value="ru">Russian</option>
                        </select>
                    </div>

                    <!-- Processing State -->
                    <div id="audio-processing"
                        style="display: none; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <div class="spinner"></div>
                        <p>Transcribing & Translating...</p>
                    </div>

                    <!-- Results (Side-by-Side) -->
                    <div id="audio-result" style="display: none; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <!-- Original -->
                        <div
                            style="background: var(--glass-bg); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--glass-border);">
                            <h4 style="margin-bottom: 0.5rem; color: var(--text-gray);">Original Transcription</h4>
                            <div id="audio-original-text"
                                style="height: 200px; overflow-y: auto; line-height: 1.6; color: var(--text); white-space: pre-wrap; margin-bottom: 1rem; font-size: 0.9rem;">
                            </div>
                            <button class="secondary-btn" onclick="copyToClipboard('audio-original-text')"
                                style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">Copy</button>
                        </div>
                        <!-- Translated -->
                        <div
                            style="background: var(--glass-bg); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--primary); box-shadow: 0 0 15px rgba(var(--primary-rgb), 0.1);">
                            <h4 style="margin-bottom: 0.5rem; color: var(--primary);">Translated Text</h4>
                            <div id="audio-translated-text"
                                style="height: 200px; overflow-y: auto; line-height: 1.6; color: var(--text); white-space: pre-wrap; margin-bottom: 1rem; font-size: 0.9rem;">
                            </div>
                            <button class="primary-btn" onclick="copyToClipboard('audio-translated-text')"
                                style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function setupAudioDragDrop() {
            const dropZone = document.getElementById('audio-drop-zone');
            const fileInput = document.getElementById('audio-upload');

            // Drag Enter/Over/Leave events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                dropZone.style.borderColor = 'var(--primary)';
                dropZone.style.background = 'rgba(255, 45, 149, 0.05)';
            }

            function unhighlight(e) {
                dropZone.style.borderColor = 'var(--border)';
                dropZone.style.background = 'transparent';
            }

            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', handleFiles, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles({ target: { files: files } });
            }

            function handleFiles(e) {
                const file = e.target.files[0];
                handleAudioUpload(file);
            }
        }

        async function handleAudioUpload(file) {
            if (!file) return;

            const targetLang = document.getElementById('target-lang').value;
            const processing = document.getElementById('audio-processing');
            const resultArea = document.getElementById('audio-result');
            const dropZone = document.getElementById('audio-drop-zone');

            // UI Updates
            dropZone.style.display = 'none';
            processing.style.display = 'flex';
            resultArea.style.display = 'none';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('target_lang', targetLang);

            try {
                // Determine API URL (Local vs Prod)
                const apiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                    ? 'http://127.0.0.1:8000/api/audio-translator'
                    : '/api/audio-translator';

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Translation failed');

                const data = await response.json();

                // Show Results
                processing.style.display = 'none';
                resultArea.style.display = 'grid';

                document.getElementById('audio-original-text').innerText = data.original_text;
                document.getElementById('audio-translated-text').innerText = data.translated_text;

            } catch (error) {
                console.error(error);
                alert('Error processing audio.');
                dropZone.style.display = 'block';
                processing.style.display = 'none';
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', setupAudioDragDrop);
    </script>
</body>

</html>